<h2>好好学习天天向上</h2><br/><h1>几个mysql问题</h1><hr/>
<div id=content class="content mod-cs-content text-content clearfix"> <p><strong>1.rownum实现</strong></p><p>mysql&gt; create table rownum (<br />&nbsp;&nbsp;&nbsp; -&gt; id int primary key,<br />&nbsp;&nbsp;&nbsp; -&gt; col int<br />&nbsp;&nbsp;&nbsp; -&gt; );<br />Query OK, 0 rows affected (0.17 sec)<br /><br />mysql&gt; insert into rownum values<br />&nbsp;&nbsp;&nbsp; -&gt; (1,26),<br />&nbsp;&nbsp;&nbsp; -&gt; (2,46),<br />&nbsp;&nbsp;&nbsp; -&gt; (3,35),<br />&nbsp;&nbsp;&nbsp; -&gt; (4,68),<br />&nbsp;&nbsp;&nbsp; -&gt; (5,93),<br />&nbsp;&nbsp;&nbsp; -&gt; (6,92);<br />Query OK, 6 rows affected (0.15 sec)<br />Records: 6&nbsp; Duplicates: 0&nbsp; Warnings: 0<br /><br />mysql&gt; rehash<br />mysql&gt; select * from rownum<br />rownum.col&nbsp; rownum.id&nbsp;&nbsp; rownum&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />mysql&gt; select * from rownum;<br />+----+------+<br />| id | col&nbsp; |<br />+----+------+<br />|&nbsp; 1 |&nbsp;&nbsp; 26 |<br />|&nbsp; 2 |&nbsp;&nbsp; 46 |<br />|&nbsp; 3 |&nbsp;&nbsp; 35 |<br />|&nbsp; 4 |&nbsp;&nbsp; 68 |<br />|&nbsp; 5 |&nbsp;&nbsp; 93 |<br />|&nbsp; 6 |&nbsp;&nbsp; 92 |<br />+----+------+<br />6 rows in set (0.00 sec)<br /><br />mysql&gt; select a.id, a.col, count(*) as rownum<br />&nbsp;&nbsp;&nbsp; -&gt; from rownum a, rownum b<br />&nbsp;&nbsp;&nbsp; -&gt; where a.col&gt;=b.col<br />&nbsp;&nbsp;&nbsp; -&gt; group by a.id, a.col;<br />+----+------+--------+<br />| id | col&nbsp; | rownum |<br />+----+------+--------+<br />|&nbsp; 1 |&nbsp;&nbsp; 26 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 |<br />|&nbsp; 2 |&nbsp;&nbsp; 46 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3 |<br />|&nbsp; 3 |&nbsp;&nbsp; 35 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2 |<br />|&nbsp; 4 |&nbsp;&nbsp; 68 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 |<br />|&nbsp; 5 |&nbsp;&nbsp; 93 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 6 |<br />|&nbsp; 6 |&nbsp;&nbsp; 92 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 5 |<br />+----+------+--------+<br />6 rows in set (0.00 sec)</p><p><strong>2.取前几条记录</strong></p>mysql&gt; create table top_n (<br />&nbsp;&nbsp;&nbsp; -&gt; id int,<br />&nbsp;&nbsp;&nbsp; -&gt; sname varchar(36),<br />&nbsp;&nbsp;&nbsp; -&gt; clsno varchar(36),<br />&nbsp;&nbsp;&nbsp; -&gt; score int<br />&nbsp;&nbsp;&nbsp; -&gt; );<br />Query OK, 0 rows affected (0.17 sec)<br /><br />mysql&gt; mysql&gt; load data infile '/home/cool/vim_sh/top_n.txt' into table top_n fields terminated by '|';<br />&nbsp;&nbsp;&nbsp; '&gt; \c<br />&nbsp;&nbsp;&nbsp; '&gt; '\c<br />mysql&gt; load data infile '/home/cool/vim_sh/top_n.txt' into table top_n fields terminated by '|';&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Query OK, 22 rows affected (0.14 sec)<br />Records: 22&nbsp; Deleted: 0&nbsp; Skipped: 0&nbsp; Warnings: 0<br /><br />mysql&gt; rehash<br />mysql&gt; select * from top_n;<br />+------+-------+-------+-------+<br />| id&nbsp;&nbsp; | sname | clsno | score |<br />+------+-------+-------+-------+<br />|&nbsp;&nbsp;&nbsp; 1 | AAAA&nbsp; | C1&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 67 |<br />|&nbsp;&nbsp;&nbsp; 2 | BBBB&nbsp; | C1&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 55 |<br />|&nbsp;&nbsp;&nbsp; 3 | CCCC&nbsp; | C1&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 67 |<br />|&nbsp;&nbsp;&nbsp; 4 | DDDD&nbsp; | C1&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 65 |<br />|&nbsp;&nbsp;&nbsp; 5 | EEEE&nbsp; | C1&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 95 |<br />|&nbsp;&nbsp;&nbsp; 6 | FFFF&nbsp; | C2&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 57 |<br />|&nbsp;&nbsp;&nbsp; 7 | GGGG&nbsp; | C2&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 87 |<br />|&nbsp;&nbsp;&nbsp; 8 | HHHH&nbsp; | C2&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 74 |<br />|&nbsp;&nbsp;&nbsp; 9 | IIII&nbsp; | C2&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 52 |<br />|&nbsp;&nbsp; 10 | JJJJ&nbsp; | C2&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 81 |<br />|&nbsp;&nbsp; 11 | KKKK&nbsp; | C2&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 67 |<br />|&nbsp;&nbsp; 12 | LLLL&nbsp; | C2&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 66 |<br />|&nbsp;&nbsp; 13 | MMMM&nbsp; | C2&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 63 |<br />|&nbsp;&nbsp; 14 | NNNN&nbsp; | C3&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 99 |<br />|&nbsp;&nbsp; 15 | OOOO&nbsp; | C3&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 50 |<br />|&nbsp;&nbsp; 16 | PPPP&nbsp; | C3&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 59 |<br />|&nbsp;&nbsp; 17 | QQQQ&nbsp; | C3&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 66 |<br />|&nbsp;&nbsp; 18 | RRRR&nbsp; | C3&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 76 |<br />|&nbsp;&nbsp; 19 | SSSS&nbsp; | C3&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 50 |<br />|&nbsp;&nbsp; 20 | TTTT&nbsp; | C3&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 50 |<br />|&nbsp;&nbsp; 21 | UUUU&nbsp; | C3&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 64 |<br />|&nbsp;&nbsp; 22 | VVVV&nbsp; | C3&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 74 |<br />+------+-------+-------+-------+<br />22 rows in set (0.00 sec)<br /><br />mysql&gt; select * <br />&nbsp;&nbsp;&nbsp; -&gt; from top_n a<br />&nbsp;&nbsp;&nbsp; -&gt; where 2&gt;(select count(*) from top_n where clsno=a.clsno and score&gt;a.score)<br />&nbsp;&nbsp;&nbsp; -&gt; order by a.clsno, a.score desc;<br />+------+-------+-------+-------+<br />| id&nbsp;&nbsp; | sname | clsno | score |<br />+------+-------+-------+-------+<br />|&nbsp;&nbsp;&nbsp; 5 | EEEE&nbsp; | C1&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 95 |<br />|&nbsp;&nbsp;&nbsp; 1 | AAAA&nbsp; | C1&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 67 |<br />|&nbsp;&nbsp;&nbsp; 3 | CCCC&nbsp; | C1&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 67 |<br />|&nbsp;&nbsp;&nbsp; 7 | GGGG&nbsp; | C2&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 87 |<br />|&nbsp;&nbsp; 10 | JJJJ&nbsp; | C2&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 81 |<br />|&nbsp;&nbsp; 14 | NNNN&nbsp; | C3&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 99 |<br />|&nbsp;&nbsp; 18 | RRRR&nbsp; | C3&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 76 |<br />+------+-------+-------+-------+<br />7 rows in set (0.00 sec)<br /><br />mysql&gt; select *&nbsp; from top_n a where 1&gt;(select count(*) from top_n where clsno=a.clsno and score&gt;a.score) order by a.clsno, a.score desc;<br />+------+-------+-------+-------+<br />| id&nbsp;&nbsp; | sname | clsno | score |<br />+------+-------+-------+-------+<br />|&nbsp;&nbsp;&nbsp; 5 | EEEE&nbsp; | C1&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 95 |<br />|&nbsp;&nbsp;&nbsp; 7 | GGGG&nbsp; | C2&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 87 |<br />|&nbsp;&nbsp; 14 | NNNN&nbsp; | C3&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 99 |<br />+------+-------+-------+-------+<br />3 rows in set (0.00 sec)<br />mysql&gt; select * from top_n where score regexp '67|66';<br />+------+-------+-------+-------+<br />| id&nbsp;&nbsp; | sname | clsno | score |<br />+------+-------+-------+-------+<br />|&nbsp;&nbsp;&nbsp; 1 | AAAA&nbsp; | C1&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 67 |<br />|&nbsp;&nbsp;&nbsp; 3 | CCCC&nbsp; | C1&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 67 |<br />|&nbsp;&nbsp; 11 | KKKK&nbsp; | C2&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 67 |<br />|&nbsp;&nbsp; 12 | LLLL&nbsp; | C2&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 66 |<br />|&nbsp;&nbsp; 17 | QQQQ&nbsp; | C3&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 66 |<br />+------+-------+-------+-------+<br /><p>5 rows in set (0.00 sec)</p><p><strong>3.交叉表查询</strong></p><p><strong></strong>mysql&gt; create table tx(</p>&nbsp;&nbsp;&nbsp; -&gt;&nbsp; id int primary key,<br />&nbsp;&nbsp;&nbsp; -&gt;&nbsp; c1 char(2),<br />&nbsp;&nbsp;&nbsp; -&gt;&nbsp; c2 char(2),<br />&nbsp;&nbsp;&nbsp; -&gt;&nbsp; c3 int<br />&nbsp;&nbsp;&nbsp; -&gt; ); <br />Query OK, 0 rows affected (0.20 sec)<br /><br />mysql&gt; insert into tx values<br />&nbsp;&nbsp;&nbsp; -&gt; (1 ,'A1','B1',9),<br />&nbsp;&nbsp;&nbsp; -&gt; (2 ,'A2','B1',7),<br />&nbsp;&nbsp;&nbsp; -&gt; (3 ,'A3','B1',4),<br />&nbsp;&nbsp;&nbsp; -&gt; (4 ,'A4','B1',2),<br />&nbsp;&nbsp;&nbsp; -&gt; (5 ,'A1','B2',2),<br />&nbsp;&nbsp;&nbsp; -&gt; (6 ,'A2','B2',9),<br />&nbsp;&nbsp;&nbsp; -&gt; (7 ,'A3','B2',8),<br />&nbsp;&nbsp;&nbsp; -&gt; (8 ,'A4','B2',5),<br />&nbsp;&nbsp;&nbsp; -&gt; (9 ,'A1','B3',1),<br />&nbsp;&nbsp;&nbsp; -&gt; (10 ,'A2','B3',8),<br />&nbsp;&nbsp;&nbsp; -&gt; (11 ,'A3','B3',8),<br />&nbsp;&nbsp;&nbsp; -&gt; (12 ,'A4','B3',6),<br />&nbsp;&nbsp;&nbsp; -&gt; (13 ,'A1','B4',8),<br />&nbsp;&nbsp;&nbsp; -&gt; (14 ,'A2','B4',2),<br />&nbsp;&nbsp;&nbsp; -&gt; (15 ,'A3','B4',6),<br />&nbsp;&nbsp;&nbsp; -&gt; (16 ,'A4','B4',9),<br />&nbsp;&nbsp;&nbsp; -&gt; (17 ,'A1','B4',3),<br />&nbsp;&nbsp;&nbsp; -&gt; (18 ,'A2','B4',5),<br />&nbsp;&nbsp;&nbsp; -&gt; (19 ,'A3','B4',2),<br />&nbsp;&nbsp;&nbsp; -&gt; (20 ,'A4','B4',5);<br />Query OK, 20 rows affected (0.16 sec)<br />Records: 20&nbsp; Duplicates: 0&nbsp; Warnings: 0<br /><br />mysql&gt; select * from tx;<br />+----+------+------+------+<br />| id | c1&nbsp;&nbsp; | c2&nbsp;&nbsp; | c3&nbsp;&nbsp; |<br />+----+------+------+------+<br />|&nbsp; 1 | A1&nbsp;&nbsp; | B1&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 9 |<br />|&nbsp; 2 | A2&nbsp;&nbsp; | B1&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 7 |<br />|&nbsp; 3 | A3&nbsp;&nbsp; | B1&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 4 |<br />|&nbsp; 4 | A4&nbsp;&nbsp; | B1&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 2 |<br />|&nbsp; 5 | A1&nbsp;&nbsp; | B2&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 2 |<br />|&nbsp; 6 | A2&nbsp;&nbsp; | B2&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 9 |<br />|&nbsp; 7 | A3&nbsp;&nbsp; | B2&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 8 |<br />|&nbsp; 8 | A4&nbsp;&nbsp; | B2&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 5 |<br />|&nbsp; 9 | A1&nbsp;&nbsp; | B3&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 1 |<br />| 10 | A2&nbsp;&nbsp; | B3&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 8 |<br />| 11 | A3&nbsp;&nbsp; | B3&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 8 |<br />| 12 | A4&nbsp;&nbsp; | B3&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 6 |<br />| 13 | A1&nbsp;&nbsp; | B4&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 8 |<br />| 14 | A2&nbsp;&nbsp; | B4&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 2 |<br />| 15 | A3&nbsp;&nbsp; | B4&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 6 |<br />| 16 | A4&nbsp;&nbsp; | B4&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 9 |<br />| 17 | A1&nbsp;&nbsp; | B4&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 3 |<br />| 18 | A2&nbsp;&nbsp; | B4&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 5 |<br />| 19 | A3&nbsp;&nbsp; | B4&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 2 |<br />| 20 | A4&nbsp;&nbsp; | B4&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 5 |<br />+----+------+------+------+<br />20 rows in set (0.00 sec)<br /><br />mysql&gt; select ifnull(c1, 'total') as total,<br />&nbsp;&nbsp;&nbsp; -&gt; sum(if(c2='B1',c3,0)) as B1,<br />&nbsp;&nbsp;&nbsp; -&gt; sum(if(c2='B2',c3,0)) as B2,<br />&nbsp;&nbsp;&nbsp; -&gt; sum(if(c2='B3',c3,0)) as B3,<br />&nbsp;&nbsp;&nbsp; -&gt; sum(if(c2='B4',c3,0)) as B4<br />&nbsp;&nbsp;&nbsp; -&gt; from tx<br />&nbsp;&nbsp;&nbsp; -&gt; group by c1 with rollup;<br />+-------+------+------+------+------+<br />| total | B1&nbsp;&nbsp; | B2&nbsp;&nbsp; | B3&nbsp;&nbsp; | B4&nbsp;&nbsp; |<br />+-------+------+------+------+------+<br />| A1&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 9 |&nbsp;&nbsp;&nbsp; 2 |&nbsp;&nbsp;&nbsp; 1 |&nbsp;&nbsp; 11 |<br />| A2&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 7 |&nbsp;&nbsp;&nbsp; 9 |&nbsp;&nbsp;&nbsp; 8 |&nbsp;&nbsp;&nbsp; 7 |<br />| A3&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 4 |&nbsp;&nbsp;&nbsp; 8 |&nbsp;&nbsp;&nbsp; 8 |&nbsp;&nbsp;&nbsp; 8 |<br />| A4&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 2 |&nbsp;&nbsp;&nbsp; 5 |&nbsp;&nbsp;&nbsp; 6 |&nbsp;&nbsp; 14 |<br />| total |&nbsp;&nbsp; 22 |&nbsp;&nbsp; 24 |&nbsp;&nbsp; 23 |&nbsp;&nbsp; 40 |<br />+-------+------+------+------+------+<br />5 rows in set (0.00 sec)<br /><br /> </div>