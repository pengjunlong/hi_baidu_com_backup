---
layout: post
title: MYSQL5.1手册5。。无备份与恢复
time: 2011-08-28 23:55
keywords: 好好学习天天向上
---
<div id=content class="content mod-cs-content text-content clearfix"> <p>   ·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>mysqld</strong></p>   <p>SQL后台程序(即MySQL服务器)。要想使用客户端程序，该程序必须运行，因为客户端通过连接服务器来访问数据库。</p>   <p>   ·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   mysqld-max</p>   <p>包括更多特性的一个服务器版本。<a href="http://database-administration.html#mysqld-max" title="5.1.2. The mysqld-max Extended MySQL Server"></a></p>   <p>   ·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   mysqld_safe</p>   <p>服务器启动脚本。如果<strong>mysqld-max</strong>存在,<strong>mysqld_safe</strong>试图启动它，否则启动<strong>mysqld</strong>。</p>   <p>   ·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   mysql.server</p>   <p>   服务器启动脚本。该脚本用于使用包含为特定级别的运行启动服务的脚本的运行目录的系统。它调用<strong>mysqld_safe</strong>来启动MySQL服务器</p>   <p>   ·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   mysqld_multi</p>   <p>服务器启动脚本，可以启动或停止系统上安装的多个服务器。<a href="http://database-administration.html#mysqld-multi" title="5.1.5. mysqld_multi — Program for Managing Multiple MySQL Servers"></a></p>   <p>   ·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   mysql_install_db</p>   <p>该脚本用默认权限创建MySQL授权表。通常只是在系统上首次安装MySQL时执行一次。</p>   <p>   ·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>mysql_fix_</strong><strong>privilege_tables</strong></p>   <p>在升级安装后，如果新版本MySQL中的   授权表有更改，则使用该脚本来更改授权表。</p><p>&nbsp;</p><p><strong>mysqld</strong>从[mysqld]和[server]组读取选项。<strong>mysqld_safe</strong>从[mysqld]、[server]、[mysqld_safe]和[safe_mysqld]组读取选项。<strong>mysql.server</strong>从    [mysqld]和[mysql.server]组读取选项。</p><p>&nbsp;</p><p>   ·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   --basedir=<i>path</i>, -b   <i>path</i></p>   <p>MySQL安装目录的路径。通常所有路径根据该路径来解析。</p><p>   ·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   --datadir=<i>path</i>, -h   <i>path</i></p>   <p>数据目录的路径。</p><p>   ·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   --default-storage-engine=<i>type</i></p>   <p>该选项为--default-table-type的同义词。</p>   <p>   ·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   --default-table-type=<i>type</i></p><p>   设置表的默认类型。</p><p>   ·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   ---log[=<i>file</i>],   -l [<i>file</i>]</p>   <p>日志连接和对文件的查询。如果你不指定文件名，MySQL使用<i>host_name</i>.log作为文件名。</p>   <p>   ·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   --log-bin=[<i>file</i>]</p>   <p>二进制日志文件。将更改数据的所有查询记入该文件。用于备份和复制。建议指定一个文件名，否则MySQL使用<i>host_name</i>-bin作为日志文件基本名。</p><p>   ·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   --pid-file=path</p>   <p><strong>   mysqld_safe</strong>使用的进程ID文件的路径。</p>   <p>   ·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   --port=<i>port_num</i>, -P   <i>port_num</i></p>   <p>帧听TCP/IP连接时使用的端口号。</p><p>   ·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   --skip-grant-tables</p>   <p>该选项使服务器不使用权限系统。该权限允许访问服务器的用户<i>不受限制地访问</i>所有<em>数据库</em>。你可以从系统外壳命令行执行<strong>mysqladmin    flush-privileges</strong>或<strong>mysqladmin    reload</strong>命令，或执行MySQL   FLUSH PRIVILEGES语句让运行的服务器重新开始使用   授权表。</p><p>   ·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   --socket=path</p>   <p>在Unix中，该选项指定用于本地连接的Unix套接字文件。   默认值是/tmp/mysql.sock。在Windows中，该选项指定本地连接所使用的管道名。   默认值是MySQL。</p><p>   ·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   --user={<i>user_name</i> |   <i>user_id</i>}, -u {<i>user_name</i> | <i>user_id</i>}</p>   <p>用<i>user_name</i>或数字用户ID<i>user_id</i>运行<strong>mysqld服务器</strong>。(“用户”指系统登录账户，而不是   授权表中所列的MySQL用户）。 <br /></p><p>   服务器将维护许多表示其配置的系统变量。所有变量均有默认值。可以在命令行中或选项文件设置选项在服务器启动时对它们进行设置。大多数可以在运行时使用SET语句来设置。</p>   <p><strong>mysqld服务器</strong>维护两种变量。全局变量影响服务器的全局操作。会话变量影响具体客户端连接相关操作。</p>   <p>服务器启动时，将所有全局变量初始化为默认值。可以在选项文件或命令行中指定的选项来更改这些默认值。服务器启动后，通过连接服务器并执行SET    GLOBAL<i>var_name</i>语句可以更改动态全局变量。要想更改全局变量，必须具有SUPER权限。</p>   <p>服务器还为每个客户端连接维护会话变量。连接时使用相应全局变量的当前值对客户端会话变量进行初始化。客户可以通过SET    SESSION<i>var_name</i>语句来更改动态会话变量。设置会话变量不需要特殊权限，但客户可以只更改自己的会话变量，而不更改其它客户的会话变量。</p>   <p>任何访问全局变量的客户端都可以看见对全局变量的更改。但是，它只影响在更改后连接的从该全局变量初始化相应会话变量的客户端。它不会影响已经连接上的客户端的会话变量(甚至是执行SET    GLOBAL语句的客户端)。</p><p>服务器维护许多提供操作相关信息的状态变量。你可以通过SHOW    STATUS语句查看这些变量和它们的值：</p>   <p>mysql&gt;<b>SHOW STATUS;</b></p>服务器关闭进程可以概括为：<p>    1.&nbsp;&nbsp;&nbsp;启动关闭进程</p>    <p>    2.&nbsp;&nbsp;&nbsp;服务器根据需要创建关闭线程</p>    <p>    3.&nbsp;&nbsp;&nbsp;服务器停止接收新连接</p>    <p>    4.&nbsp;&nbsp;&nbsp;服务器终止当前的活动</p>    <p>    5.&nbsp;&nbsp;&nbsp;存储引擎被停掉或关闭</p>    <p>    6.&nbsp;&nbsp;&nbsp;服务器退出</p><p>运行MySQL时，应尽量遵从下面的指导：</p>   <p>   ·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>不要让任何人(除了MySQL</strong><b>root</b><strong>账户)访问</strong><b>mysql</b><strong>数据库中的</strong><b>user</b><strong>表！</strong>这很关键。<strong>加密的密码才是MySQL中的真正的密码。</strong>知道user表中所列的密码并且能访问该账户客访问的主机的人<strong>可以很容易地用该用户登录</strong>。</p>   <p>   ·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;学习MySQL访问权限系统。用GRANT和REVOKE语句来控制对MySQL的访问。不要授予超过需求的权限。决不能为所有主机授权。</p><p>   一个常见的错误是只保护字符串数据值。一定要记住还应检查数字数据。如果当用户输入值234时，应用程序生成查询SELECT    * FROM table WHERE ID=234，用户可以输入值234    OR 1=1使应用程序生成查询SELECT    * FROM table WHERE ID=234 OR 1=1。结果是服务器查找表内的每个记录。这样会暴露每个记录并造成过多的服务器负载。保护防范这类攻击的最简单的方法是使用单引号将数字常量引起来：SELECT    * FROM table WHERE ID='234'。如果用户输入其它信息，均变为字符串的一部分。在数字部分，MySQL自动将字符串转换为数字并剥离字符串包含的附加的非数字字符。</p>   <p>有时候人们会认为如果数据库只包含供公共使用的数据，则不需要保护。这是不正确的。即使允许显示数据库中的任何记录，你仍然应保护防范拒绝服务攻击(例如，基于前面段落中所述的技术的攻击，会使服务器浪费资源)。否则，你的服务器不再响应合法用户。</p><p><strong>   mysqld</strong>为有SUPER权限的用户专门保留一个额外的连接，因此即使所有普通连接被占用，MySQL   root用户仍可以登录并检查服务器的活动。</p><p>不要允许使用表的符号链接。(可以用--skip-symbolic-links选项禁用）。不要将PROCESS或SUPER权限授给非管理用户。<strong>mysqladmin    processlist</strong>的输出显示出当前执行的查询正文，不要向非管理用户授予FILE权限。有这权限的任何用户能在拥有<b>mysqld</b>守护进程权限的文件系统那里写一个文件.&nbsp; 如果你不信任你的DNS，你应该在授权表中使用IP数字而不是主机名。在任何情况下，你应该非常小心地使用包含通配符的主机名来创建   授权表条目！</p><p>LOAD DATA语句可以装载服务器主机上的文件，若指定LOCAL关键字，可以装载客户端文件。对于<strong>mysql</strong>命令行客户端，可以通过指定--local-infile[=1]选项启用LOAD    DATA LOCAL，或通过--local-infile=0选项禁用。</p><p><strong>      MySQL</strong>存取控制包含2个阶段：</p>   <ul><li>阶段1：服务器检查是否允许你连接。</li><li>阶段2：假定你能连接，服务器检查你发出的每个请求。看你是否有足够的权限实施它。</li></ul>可以从命令行按照下述提示启动<strong>MySQL</strong>客户端(用shell&gt;表示)：   shell&gt; MySQL<b> -h <i>host_name</i> -u <i>user_name</i> -p<i>your_pass</i></b>   <p>-h,   -u和-p选项还可以采用形式--host=<i>host_name</i>、--user=<i>user_name</i>和--password=<i>your_pass</i>。请注意在-p或--password=和后面的密码之间<i>没有<em>空格</em></i>。</p><p>   ·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   对于指定为IP号的Host值，你可以指定一个网络掩码，说明使用多少位地址位来评比网络号。例如：</p>   ·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mysql&gt; <b>GRANT ALL PRIVILEGES ON db.*</b>   ·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;-&gt; -&gt; <b>TO david@'192.58.197.0/255.255.255.0';</b>   <p>允许david从任何客户端用IP号client_ip来连接，下面的条件为真：</p>   client_ip &amp; netmask = host_ip   <p>That is, for the   GRANT    statement just shown: </p>   client_ip &amp; 255.255.255.0 = 192.58.197.0   <p>满足该条件并可以连接MySQL服务器的IP号的范围为192.58.197.0到192.58.197.255。</p><p>当mysqld启动时，所有授权表的内容被读进内存并且从此时生效。</p>   <p>当服务器注意到授权表被改变了时，现存的客户端连接有如下影响： </p>   <ul><li>表和列权限在客户端的下一次请求时生效。</li><li>数据库权限改变在下一个USE    <i>db_name</i>命令生效。</li></ul>   <p>   ·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   全局权限的改变和密码改变在下一次客户端连接时生效。</p>   <p>如果用GRANT、REVOKE或SET    PASSWORD对授权表进行修改，服务器会注意到并立即重新将授权表载入内存。</p>   <p>如果你手动地修改授权表(使用INSERT、UPDATE或DELETE等等)，你应该执行<strong>mysqladmin    flush-privileges</strong>或<strong>mysqladmin    reload</strong>告诉服务器再装载授权表，否则你的更改将<em>不会生效</em>，除非你重启服务器。</p>mysql&gt; <b>GRANT ...</b>   &nbsp;&nbsp;&nbsp; -&gt;&nbsp;&nbsp;&nbsp;&nbsp; <b>ON *.*</b>   &nbsp;&nbsp;&nbsp; -&gt;&nbsp;&nbsp;&nbsp;&nbsp; <b>TO 'myname'@'%.mydomain.com'</b>   &nbsp;&nbsp;&nbsp; -&gt;&nbsp;&nbsp;&nbsp;&nbsp; <b>IDENTIFIED BY 'mypass';</b>   <p>要想通过直接修改授权表来实现：</p>   mysql&gt; <b>INSERT INTO user (Host,User,Password,...)</b>   &nbsp;&nbsp;&nbsp; -&gt;&nbsp;&nbsp;&nbsp;&nbsp; <b>VALUES('%.mydomain.com','myname',PASSWORD('mypass'),...);</b>   <p>mysql&gt;    <b>FLUSH PRIVILEGES;</b></p><p>要想用GRANT语句设置资源限制，使WITH子句来命名每个要限制的资源和根据每小时记数的限制值。例如，要想只以限制方式创建可以访问customer数据库的新账户，执行该语句：</p>   mysql&gt; <b>GRANT ALL ON customer.* TO 'francis'@'localhost'</b>   &nbsp;&nbsp;&nbsp; -&gt;&nbsp;&nbsp;&nbsp;&nbsp; <b>IDENTIFIED BY 'frank'</b>   &nbsp;&nbsp;&nbsp; -&gt;&nbsp;&nbsp;&nbsp;&nbsp; <b>WITH MAX_QUERIES_PER_HOUR 20</b>   &nbsp;&nbsp;&nbsp; -&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>MAX_UPDATES_PER_HOUR 10</b>   &nbsp;&nbsp;&nbsp; -&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>MAX_CONNECTIONS_PER_HOUR 5</b>   <p>&nbsp;&nbsp;&nbsp; -&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>MAX_USER_CONNECTIONS 2;</b></p><p>MySQL有几个不同的日志文件，可以帮助你找出<strong>mysqld</strong>内部发生的事情：</p>             <p><strong>日志文件</strong></p>        <p><strong>    记入文件中的信息类型</strong></p>              <p>错误日志</p>        <p>记录启动、运行或停止<strong>mysqld</strong><b>时出</b>现的问题。</p>              <p>查询日志</p>        <p>记录建立的客户端连接和执行的语句。</p>              <p>更新日志</p>        <p>记录更改数据的语句。不赞成使用该日志。</p>              <p>二进制日志</p>        <p>记录所有更改数据的语句。还用于复制。</p>              <p>慢日志</p>        <p>记录所有执行时间超过long_query_time秒的所有查询或不使用索引的查询。</p><p>可以用--log-error[=<i>file_name</i>]选项来指定<strong>mysqld</strong>保存错误日志文件的位置。如果没有给定<i>file_name</i>值，<strong>mysqld</strong>使用错误日志名<i>host_name.err   </i>并在数据目录中写入日志文件。</p><p>如果你想要知道<strong>mysqld</strong>内部发生了什么，你应该用--log[=<i>file_name</i>]或-l    [<i>file_name</i>]选项启动它。如果没有给定<i>file_name</i>的值，   默认名是<i>host_name</i>.log<b>。</b>所有连接和语句被记录到日志文件。</p><p><strong>注</strong>释：二进制日志已经代替了老的更新日志，更新日志在MySQL    5.1中不再使用。</p><p>      二进制日志还包含关于每个更新数据库的语句的执行时间信息。它不包含没有修改任何数据的语句。</p><p>运行服务器时若启用二进制日志则性能大约慢1%。但是，二进制日志的好处，即用于恢复并允许设置复制超过了这个小小的性能损失。</p>当用--log-bin[=<i>file_name</i>]选项启动时，<strong>mysqld</strong>写入包含所有更新数据的SQL命令的日志文件。如果未给出<i>file_name</i>值，   默认名为-bin后面所跟的主机名。如果给出了文件名，但没有包含路径，则文件被写入数据目录。建议指定一个文件名，<p>用--log-slow-queries[=<i>file_name</i>]选项启动时，<strong>mysqld</strong>写一个包含所有执行时间超过long_query_time秒的SQL语句的日志文件。获得初使表锁定的时间不算作执行时间。如果没有给出<i>file_name</i>值，   默认未主机名，后缀为-slow.log。</p>可以在SELECT语句中指定查询缓存相关选项：<p>   ·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;         &nbsp;SQL_CACHE</p>   <p>如果query_cache_type系统变量的值是ON或DEMAND，查询结果被缓存。</p>   <p>   ·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;         &nbsp;SQL_NO_CACHE</p>   <p>查询结果不被缓存。</p>   <p>示例：</p>   SELECT SQL_CACHE id, name FROM customer;   <p>SELECT SQL_NO_CACHE id, name FROM customer;</p><p>为了监视查询缓存性能，使用SHOW    STATUS查看缓存状态变量：</p>   mysql&gt; <b>SHOW STATUS LIKE 'Qcache%';</b> </div>