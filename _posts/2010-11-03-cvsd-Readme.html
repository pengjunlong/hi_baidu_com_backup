tag=好好学习天天向上
<div id=content class="content mod-cs-content text-content clearfix"> &#160;&#160; cvsd - chroot wrapper to run 'cvs pserver' more securely.<br /><br />cvsd was originally written by Chris Black &lt;cblack@mokey.com&gt;,<br />http://cblack.mokey.com/. That was until release 0.6.<br /><br />cvsd versions up till 0.8b3 were maintained by Philippe Kehl<br />&lt;phkehl@gmx.net&gt;, http://guv.ethz.ch/~flip/cvsd/,<br />http://www.oinkzwurgl.org/software/cvsd/.<br /><br />after that Arthur de Jong &lt;arthur@arthurdejong.org&gt;<br />took up the work and did a complete rewrite,<br />http://arthurdejong.org/cvsd.<br /><br />Copyright (C) 1999 Chris Black.<br />Copyright (C) 2000 Philippe Kehl.<br />Copyright (C) 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009,<br />2010 Arthur de Jong.<br /><br />This program is free software; you can redistribute it and/or modify<br />it under the terms of the GNU General Public License as published by<br />the Free Software Foundation; either version 2, or (at your option)<br />any later version.<br /><br />This program is distributed in the hope that it will be useful,<br />but WITHOUT ANY WARRANTY; without even the implied warranty of<br />MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&#160; See the<br />GNU General Public License for more details.<br /><br />You should have received a copy of the GNU General Public License<br />along with this program; if not, write to the Free Software<br />Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA<br /><br /><br />INTRODUCTION<br />============<br /><br />cvsd is a wrapper program for cvs in pserver mode. it will run 'cvs pserver'<br />under a special uid/gid in a chroot jail.<br /><br />cvsd is run as a daemon and is controlled through a configuration file. It is<br />relatively easy to configure and provides tools for easy setting up a chroot<br />jail.<br /><br />This server can be useful if you want to run a public cvs pserver. You should<br />however be aware of the security limitations of running a cvs pserver. If you<br />want any kind of authentication you should really consider using secure shell<br />as a secure authentication mechanism and transport. Passwords used in cvs<br />pserver are transmitted in plain text.<br /><br />This wrapper adds a layer of security to the cvs server. cvs is a very<br />powerful tool and is capable of running scripts and other things. Running cvs<br />in a chroot jail it is possible to limit the amount of &quot;damage&quot; cvs can do if<br />it is exploited. It is generally a good idea to run cvsd without any write<br />permissions to any directory on the system.<br /><br />Features of cvsd include:<br />* running in chroot jail<br />* configuring chroot jail<br />* running under a non-root uid<br />* set a nice value<br />* limit resource usage<br />* limit number of connections<br />* relatively easy to set up<br /><br /><br />INSTALLING CVSD<br />===============<br /><br />In short:<br />% ./configure<br />% make<br />% make install<br /><br />You can add '--sysconfdir=/etc', '--prefix', '--enable-warnings' and/or<br />'--enable-debug' options to configure to tune installation. Debugging is only<br />recommended for finding bugs.<br /><br />cvsd is developed on a Debian GNU/Linux system and should work fine on most<br />GNU/Linux systems. The code is supposed to be portable but is not regularly<br />tested on other platforms. cvsd is known to work on Solaris, FreeBSD, OpenBSD<br />and others.<br /><br />tcp wrappers<br />------------<br /><br />cvsd currently has experimental support for tcp wrappers. Use './configure<br />--with-libwrap' to enable support. Most versions of the tcp wrapper libraries<br />have issues with systems supporting IPv6, see the FAQ.<br /><br />Using this option will have a slight performance hit on the number of<br />connections that can be handled per minute. For each incoming connection the<br />tcp wrapper reads the configuration files and does a name lookup. This is done<br />inside the main loop before the child is forked..<br /><br />Also note that you have to edit the hosts.allow and hosts.deny files INSIDE<br />the chroot jail since the tcp wrapper libraries reread these files for every<br />connection.<br /><br /><br />CONFIGURING CVSD<br />================<br /><br />cvsd is controlled through a configuration file in /etc/cvsd/cvsd.conf (or<br />maybe /usr/local/etc/cvsd/cvsd.conf depending where you set --prefix to with<br />configure). The default configuration file is fully commented and has a<br />manual page (cvsd.conf(5)) which documents use of the configuration file.<br /><br />very quick setup guide<br />----------------------<br /><br />The is just a series of commands to set up cvsd in a typical read-only setup.<br />If you don't understand these steps or are looking for commands that work on<br />your system you should look below for further details.<br /><br /># addgroup --system cvsd&#160;&#160;&#160;&#160;&#160;&#160; (or groupadd)<br /># adduser --system --ingroup cvsd --home /var/lib/cvsd \<br />--shell /bin/false --gecos 'cvs pserver daemon' cvsd<br /># cvsd-buildroot /var/lib/cvsd<br /># cvs -d /var/lib/cvsd/myrepos init<br /># cvsd-passwd /var/lib/cvsd/myrepos +anonymous<br /># touch /var/lib/cvsd/myrepos/CVSROOT/writers<br />edit /var/lib/cvsd/myrepos/CVSROOT/config<br />add &quot;SystemAuth=no&quot;<br />add &quot;PamAuth=no&quot;&#160;&#160;&#160;&#160;&#160; (on systems that have this option)<br />add &quot;LockDir=/tmp/myrepos&quot;<br /># mkdir /var/lib/cvsd/tmp/myrepos<br /># chown cvsd:cvsd /var/lib/cvsd/tmp/myrepos<br />edit /etc/cvsd/cvsd.conf<br />set &quot;RootJail /var/lib/cvsd&quot;<br />set &quot;Repos /myrepos&quot;<br /><br />You should now be able to continue with the section &quot;checking the<br />configuration&quot; below.<br /><br />setting up the user and group<br />-----------------------------<br /><br />You should setup a user and group under which cvsd is run. Adding users to<br />the system is different on most platforms but this should work for most<br />systems:<br /># addgroup cvsd<br /># adduser --system --ingroup cvsd --home /var/lib/cvsd \<br />--shell /bin/false --gecos 'cvs pserver daemon' cvsd<br />or maybe (or some other variation depending on your system):<br /># groupadd cvsd<br /># useradd -r -M -d /var/lib/cvsd -s /bin/false \<br />-c &quot;cvs pserver daemon&quot; -g cvsd cvsd<br /><br />(replace /var/lib/cvsd with the place where your chrooted file system is<br />located)<br /><br />setting up a chroot jail<br />------------------------<br /><br />You can populate a chrooted file system with cvsd-buildroot. You should rerun<br />this script if your cvs binary changes or the libraries that it depends upon.<br />The place where you create the chroot file system should be specified in the<br />configuration file as the 'RootJail'. It is possible (but not advisable) to<br />run cvsd without a chrooted file system.<br /><br />If you plan to run stuff like the scripts from the contrib/ subdirectory in<br />cvs, then you have to have all necessary binaries, libraries etc. etc. in the<br />chrooted file system. You can just put the needed binaries in the 'bin'<br />directory of the chroot jail and 'cvsd-buildroot' will install the needed<br />libraries. Please note that this may require manual reconfiguring.<br /><br />Some systems may require extra libraries to be present in the chrooted file<br />system than can not be automatically detected (using ldd). See the FAQ for<br />details.<br /><br />disabling inetd pserver<br />-----------------------<br /><br />If inetd is configured to start cvs /etc/inetd.conf should contain a line<br />like this:<br />cvspserver&#160;&#160; stream&#160;&#160; tcp&#160; nowait&#160; root /usr/bin/cvs --allow-root /home/cvs<br />You should remove or comment out this line or tell cvsd to listen on a<br />different port (use Listen option in cvsd.conf). If you change inetd.conf you<br />should tell inetd to reload it's configuration by:<br /># kill -s HUP &lt;pidofinetd&gt;<br /><br />setting up a repository<br />-----------------------<br /><br />If you have configured the chroot jail and the user and group id bits you can<br />start adding repositories to the chroot jail. There are a couple of ways you<br />could do that.<br /><br />The first is creating an empty repository with something like:<br /># cvs -d /var/lib/cvsd/myrepos init<br />(where /var/lib/cvsd is the location of the chroot jail and myrepos is the<br />name of the new repository)<br /><br />Another way is copying an already existing repository to the chroot jail. It<br />is also possible to do something smart with a tool like 'rsync'. Put this in<br />a cronjob for extra effect.<br /><br />Symbolic linking a repository to the chroot jail is not possible since<br />symbolic links will be evaluated within the chroot jail. Hard linking directories<br />should be avoided (hard linking in general in my opinion). With Linux 2.4 (and<br />probably other systems) it is possible to remount an existing directory<br />within another directory. You can use mount:<br /># mount --bind /home/user/develrepos /var/lib/cvsd/userrepos<br />or add something like this to /etc/fstab:<br />/home/user/develrepos /var/lib/cvsd/userrepos none bind 0 0<br />(don't forget to create the /var/lib/cvsd/userrepos directory)<br /><br />After you have created or copied a repository into the chroot jail you should<br />add it to the cvsd.conf configuration file so cvs can access it. Use the<br />'Repos' option for this and remember to specify it relative to the chroot<br />jail. So if your repository is /var/lib/cvsd/myrepos you should add 'Repos<br />/myrepos' to the configuration file.<br /><br />The last step for making your repository accessible is to add a passwd file<br />to the 'CVSROOT' directory of the repository. The cvsd-passwd tool will do<br />this for you.<br />cvsd-passwd /var/lib/cvsd/myrepos anonymous<br />This will add user 'anonymous' to the list of users that can access the<br />repository. You will be prompted for a password which can optionally be<br />blank.<br /><br />Note that the cvsd user needs to have the correct permissions to the<br />repository. The cvsd user probably should have read access to the repository<br />but probably no write permission. You can add all users in the repository<br />passwd file to a file named 'readers' in the 'CVSROOT' directory or create an<br />empty 'writers' file. Without any of these files all users have write access!<br /><br />If you set up your repository so that the cvsd user only has read access to<br />the files and directories in the repository (through unix file permissions)<br />you need to take some extra provisions since cvs creates lockfiles when<br />checking out files from the repository. The best way to do this is to create<br />a directory for the cvsd user to write the lockfiles to (e.g.<br />/var/lib/cvsd/tmp/myrepos) and add &quot;LockDir=/tmp/myrepos&quot; to the<br />/var/lib/cvsd/myrepos/CVSROOT/config file. Be sure to create the directory<br />and make it writable for the cvsd user. If your cvsd user has write access to<br />the repository this should be no problem.<br /><br />It is also a good idea to put &quot;SystemAuth=no&quot; and maybe &quot;PamAuth=no&quot; in your<br />CVSROOT/config file. This way password lookups will only be done to<br />CVSROOT/config and not to /etc/passwd inside the chroot jail (that passwd<br />file shouldn't contain any passwords) or PAM.<br /><br />See the &quot;Password authentication server&quot; section in the cvs texinfo document<br />for more information about running a pserver and setting up repositories.<br /><br /><br />CHECKING THE CONFIGURATION<br />==========================<br /><br />If you have started cvsd with the provided init script:<br /># /etc/init.d/cvsd start<br />(or /usr/local/etc/init.d/cvsd start) and configured a repository (say<br />myrepos) you should be able to access the server with something like:<br />% cvs -d :pserver:anonymous@localhost:/myrepos login<br />% cvs -d :pserver:anonymous@localhost:/myrepos checkout .<br />For troubleshooting information see the FAQ on debugging.<br /><br /><br />REPORTING BUGS<br />==============<br /><br />If you find any bugs or missing features please send email to<br />arthur@arthurdejong.org<br />Please include as much information as needed (platform, output of configure<br />if compilation fails, output of the failure, etc). Most of the configuration<br />information can be provided by running cvsd-buginfo. Patches are more than<br />welcome. </div>