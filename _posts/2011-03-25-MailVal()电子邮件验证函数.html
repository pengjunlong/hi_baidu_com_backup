tag=好好学习天天向上
<div id=content class="content mod-cs-content text-content clearfix"> MailVal()<blockquote><p> *This function checks the format of an email address. There are five levels of<br />  * checking:<br />  *<br />  * 1 – Basic format checking. Ensures that:<br />  *     There is an @ sign with something on the left and something on the right<br />  *     To the right of the @ sign, there’s at least one dot, with something to the left and right.<br />  *     To the right of the last dot is either 2 or 3 letters, or the special case “arpa”<br />  * 2 – The above, plus the letters to the right of the last dot are:<br />  *     com, net, org, edu, mil, gov, int, arpa or one of the two-letter country codes<br />  * 3 – The above, plus attempts to check if there is an MX (Mail eXchange) record for the<br />  *     domain name.<br />  * 4 – The above, plus attempt to connect to the mail server<br />  * 5 – The above, plus check to see if there is a response from the mail server. The third<br />  *     argument to this function is optional, and sets the number of times to loop while<br />  *     waiting for a response from the mail server. The default is 15000. The actual waiting<br />  *     time, of course, depends on such things as the speed of your server.<br />  *<br />  * Level 1 is bulletproof: if the address fails this level, it’s bad. Level 2 is still<br />  * pretty solid, but less certain: there could be valid TLDs overlooked when writing<br />  * this function, or new ones could be added. Level 3 is even less certain: there are<br />  * a number of things that could prevent finding an MX record for a valid address<br />  * at any given time. 4 and 5 are even less certain still. Ultimately, the only absolutely<br />  * positive way to test an email address is to send something to it.<br />  *<br />  * The function returns 0 for a valid address, or the level at which it failed, for an<br />  * invalid address.</p></blockquote>&lt;?php&nbsp;function MailVal($Addr, $Level, $Timeout = 15000) {&nbsp;//  Valid Top-Level Domains    $gTLDs = &quot;com:net:org:edu:gov:mil:int:arpa:&quot;;    $CCs   = &quot;ad:ae:af:ag:ai:al:am:an:ao:aq:ar:as:at:au:aw:az:ba:bb:bd:be:bf:&quot;.             &quot;bg:bh:bi:bj:bm:bn:bo:br:bs:bt:bv:bw:by:bz:ca:cc:cf:cd:cg:ch:ci:&quot;.             &quot;ck:cl:cm:cn:co:cr:cs:cu:cv:cx:cy:cz:de:dj:dk:dm:do:dz:ec:ee:eg:&quot;.             &quot;eh:er:es:et:fi:fj:fk:fm:fo:fr:fx:ga:gb:gd:ge:gf:gh:gi:gl:gm:gn:&quot;.             &quot;gp:gq:gr:gs:gt:gu:gw:gy:hk:hm:hn:hr:ht:hu:id:ie:il:in:io:iq:ir:&quot;.             &quot;is:it:jm:jo:jp:ke:kg:kh:ki:km:kn:kp:kr:kw:ky:kz:la:lb:lc:li:lk:&quot;.             &quot;lr:ls:lt:lu:lv:ly:ma:mc:md:mg:mh:mk:ml:mm:mn:mo:mp:mq:mr:ms:mt:&quot;.             &quot;mu:mv:mw:mx:my:mz:na:nc:ne:nf:ng:ni:nl:no:np:nr:nt:nu:nz:om:pa:&quot;.             &quot;pe:pf:pg:ph:pk:pl:pm:pn:pr:pt:pw:py:qa:re:ro:ru:rw:sa:sb:sc:sd:&quot;.             &quot;se:sg:sh:si:sj:sk:sl:sm:sn:so:sr:st:su:sv:sy:sz:tc:td:tf:tg:th:&quot;.             &quot;tj:tk:tm:tn:to:tp:tr:tt:tv:tw:tz:ua:ug:uk:um:us:uy:uz:va:vc:ve:&quot;.             &quot;vg:vi:vn:vu:wf:ws:ye:yt:yu:za:zm:zr:zw:&quot;;&nbsp;//  The countries can have their own 'TLDs', e.g. mydomain.com.au    $cTLDs = &quot;com:net:org:edu:gov:mil:co:ne:or:ed:go:mi:&quot;;&nbsp;    $fail = 0;&nbsp;//  Shift the address to lowercase to simplify checking    $Addr = strtolower($Addr);&nbsp;//  Split the Address into user and domain parts    $UD = explode(&quot;@&quot;, $Addr);    if (sizeof($UD) != 2 || !$UD[0]) $fail = 1;&nbsp;//  Split the domain part into its Levels    $Levels = explode(&quot;.&quot;, $UD[1]); $sLevels = sizeof($Levels);    if ($sLevels &lt; 2) $fail = 1;&nbsp;//  Get the TLD, strip off trailing ] } ) &gt; and check the length    $tld = $Levels[$sLevels-1];    $tld = ereg_replace(&quot;[&gt;)}]$|]$&quot;, &quot;&quot;, $tld);    if (strlen($tld) &lt; 2 || strlen($tld) &gt; 3 &amp;&amp; $tld != &quot;arpa&quot;) $fail = 1;&nbsp;    $Level--;&nbsp;//  If the string after the last dot isn't in the generic TLDs or country codes, it's invalid.    if ($Level &amp;&amp; !$fail) {    $Level--;    if (!ereg($tld.&quot;:&quot;, $gTLDs) &amp;&amp; !ereg($tld.&quot;:&quot;, $CCs)) $fail = 2;    }&nbsp;//  If it's a country code, check for a country TLD; add on the domain name.    if ($Level &amp;&amp; !$fail) {    $cd = $sLevels - 2; $domain = $Levels[$cd].&quot;.&quot;.$tld;    if (ereg($Levels[$cd].&quot;:&quot;, $cTLDs)) { $cd--; $domain = $Levels[$cd].&quot;.&quot;.$domain; }    }&nbsp;//  See if there's an MX record for the domain    if ($Level &amp;&amp; !$fail) {    $Level--;    if (!getmxrr($domain, $mxhosts, $weight)) $fail = 3;    }&nbsp;//  Attempt to connect to port 25 on an MX host    if ($Level &amp;&amp; !$fail) {    $Level--;    while (!$sh &amp;&amp; list($nul, $mxhost) = each($mxhosts))      $sh = fsockopen($mxhost, 25);    if (!$sh) $fail = 4;    }&nbsp;//  See if anyone answers    if ($Level &amp;&amp; !$fail) {    $Level--;    set_socket_blocking($sh, false);    $out = &quot;&quot;; $t = 0;    while ($t++ &lt; $Timeout &amp;&amp; !$out)      $out = fgets($sh, 256);    if (!ereg(&quot;^220&quot;, $out)) $fail = 5;    }&nbsp;    if ($sh) fclose($sh);&nbsp;    return $fail;  } //MailVal?&gt;&nbsp;&nbsp;Usage Example&nbsp;&nbsp;&lt;?  if (MailVal($Address, 2)) echo &quot;Invalid address&quot;;?&gt;<hr />注释:<a href="http://baike.baidu.com/view/30676.htm" target="_blank">MX记录（Mail Exchange）：邮件路由记录</a><p>　　<br />　　说明：用户可以将该域名下的邮件服务器指向到自己的mail server上，然后即可自行操作控制所有的邮箱设置。您只需在线填写您服务器的主机名或主机IP地址，即可将您域名下的邮件全部转到您自己设定相应的邮件服务器上。<br />　　这个大家都明白了吗？就是将你的域名中邮件服务器分开，将它设置到其它的IP去！<br />　　比如同样是 cnMonkey_com ，如果你设置A记录是指向123.12.123.123，而MX记录你设置是指向222.22.222.222，那么你的DNS服务器接收到别人的邮件路 由请求时就将会将它的请求解释到222.22.222.222上去！而别人访问你的网页的时候仍然是访问123.12.123.123。　<br />　　可以使用nslookup -qt=mx test_com来解析mx的指向。例子中以test_com为例。</p> </div>