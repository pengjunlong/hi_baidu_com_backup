tag=好好学习天天向上
<div id=content class="content mod-cs-content text-content clearfix"> How to control fan speed   <ul><li>Bookmark with:</li><li> <a title="Post this story to Delicious" href="http://del.icio.us/post?url=http://www.thinkwiki.org/wiki/How_to_control_fan_speed&amp;title=How%20to%20control%20fan%20speed%20-%20ThinkWiki">Delicious</a> </li><li> <a title="Post this story to Digg" href="http://digg.com/submit?url=http://www.thinkwiki.org/wiki/How_to_control_fan_speed&amp;title=How%20to%20control%20fan%20speed%20-%20ThinkWiki">Digg</a> </li><li> <a title="Post this story to reddit" href="http://reddit.com/submit?url=http://www.thinkwiki.org/wiki/How_to_control_fan_speed&amp;title=How%20to%20control%20fan%20speed%20-%20ThinkWiki">reddit</a> </li><li> <a title="Post this story to Facebook" href="http://www.facebook.com/sharer.php?u=http://www.thinkwiki.org/wiki/How_to_control_fan_speed">Facebook</a> </li><li> <a title="Post this story to StumbleUpon" href="http://www.stumbleupon.com/submit?url=http://www.thinkwiki.org/wiki/How_to_control_fan_speed&amp;title=How%20to%20control%20fan%20speed%20-%20ThinkWiki">StumbleUpon</a> </li></ul>                       <p>This page discusses methods for controlling the system fan.</p> Contents [<a>hide</a>]<ul><li><a href="http://www.thinkwiki.org/wiki/How_to_control_fan_speed#For_Linux">1 For Linux</a><ul><li><a href="http://www.thinkwiki.org/wiki/How_to_control_fan_speed#Automated_control_scripts">1.1 Automated control scripts</a></li><li><a href="http://www.thinkwiki.org/wiki/How_to_control_fan_speed#Automated_program_-_Simple_ThinkPad_Fan_Control">1.2 Automated program - Simple ThinkPad Fan Control</a></li></ul></li><li><a href="http://www.thinkwiki.org/wiki/How_to_control_fan_speed#For_Windows">2 For Windows</a></li><li><a href="http://www.thinkwiki.org/wiki/How_to_control_fan_speed#Hardware_specs">3 Hardware specs</a><ul><li><a href="http://www.thinkwiki.org/wiki/How_to_control_fan_speed#Fan_Tachometer">3.1 Fan Tachometer</a></li><li><a href="http://www.thinkwiki.org/wiki/How_to_control_fan_speed#Automatic_mode">3.2 Automatic mode</a></li><li><a href="http://www.thinkwiki.org/wiki/How_to_control_fan_speed#Manual_mode">3.3 Manual mode</a></li><li><a href="http://www.thinkwiki.org/wiki/How_to_control_fan_speed#Disengaged_.28full-speed.29_mode">3.4 Disengaged (full-speed) mode</a></li></ul></li><li><a href="http://www.thinkwiki.org/wiki/How_to_control_fan_speed#Supported_models">4 Supported models</a></li><li><a href="http://www.thinkwiki.org/wiki/How_to_control_fan_speed#Models_using_a_different_interface">5 Models using a different interface</a></li><li><a href="http://www.thinkwiki.org/wiki/How_to_control_fan_speed#Unsupported_models">6 Unsupported models</a></li></ul><b>ATTENTION!</b>When designing fan-control applets, never ignore a valid thermal sensor.<p>Even if it seems to be stuck at a certain temperature, you must take that sensor into account.  While it will probably make the fan spin faster than if the sensor was ignored, that's exactly what would happen when the fan is under EC control, and could very well be the reason for the &quot;stuck&quot; value in the first place.</p>Always play it safe.  If a battery pack seems to want the fan to always run faster, the only safe thing to do is to make it run faster. For Linux<b>NOTE!</b>Fan control operations are disabled by default for safety reasons.<p>To enable fan control, the module parameter <tt>fan_control=1</tt> must be given to thinkpad-acpi.</p><p>For example, in Ubuntu 8.04 (Hardy Heron), add the following to <tt>/etc/modprobe.d/options</tt>: <tt>options thinkpad_acpi fan_control=1</tt></p><p>For Debian Squeeze (testing) create <tt>/etc/modprobe.d/thinkpad_acpi.conf</tt> with: <tt>options thinkpad_acpi fan_control=1</tt> and install the package <tt>thinkfan</tt></p><p>Having done so, reboot and you can use the following commands to control fan speed:</p><p><code># echo level 0 &gt; /proc/acpi/ibm/fan</code> (fan off)</p><p><code># echo level 2 &gt; /proc/acpi/ibm/fan</code> (low speed)</p><p><code># echo level 4 &gt; /proc/acpi/ibm/fan</code> (medium speed)</p><p><code># echo level 7 &gt; /proc/acpi/ibm/fan</code> (maximum speed)</p><p><code># echo level auto &gt; /proc/acpi/ibm/fan</code> (automatic - default)</p><p><code># echo level disengaged &gt; /proc/acpi/ibm/fan</code> (disengaged)</p><p>If you receive a PERMISSION DENIED error you can use the following command syntax instead as a work-around:</p><p><code># echo level 0 | sudo tee /proc/acpi/ibm/fan</code> (fan off)</p><p><code># echo level 2 | sudo tee /proc/acpi/ibm/fan</code> (low speed)</p><p><code># echo level 4 | sudo tee /proc/acpi/ibm/fan</code> (medium speed)</p><p><code># echo level 7 | sudo tee /proc/acpi/ibm/fan</code> (maximum speed)</p><p><code># echo level auto | sudo tee /proc/acpi/ibm/fan</code> (automatic - default)</p><p><code># echo level disengaged | sudo tee /proc/acpi/ibm/fan</code> (disengaged)</p> Automated control scripts<p>An <a href="http://www.thinkwiki.org/wiki/ACPI_fan_control_script#Variable_speed_control_scripts" title="ACPI fan control script">ACPI fan control script</a> can be used to override the firmware's fan algorithm with gentler, quieter version. It monitors the <a href="http://www.thinkwiki.org/wiki/How_to_control_fan_speed#">laptop's</a> <a href="http://www.thinkwiki.org/wiki/Thermal_sensors" title="Thermal sensors">thermal sensors</a> and sets the fan speed accordingly, according to customizable thresholds. For the default behavior, simply save <tt><a href="http://www.thinkwiki.org/wiki/Talk:Code/tp-fancontrol" title="Talk:Code/tp-fancontrol">tp-fancontrol</a></tt> (<a href="http://www.thinkwiki.org/index.php?title=Code/tp-fancontrol&amp;action=raw&amp;ctype=application/octet-stream" rel="nofollow">download</a>) as <tt>tp-fancontrol</tt>, make sure you've loaded <a href="http://www.thinkwiki.org/wiki/Thinkpad-acpi" title="Thinkpad-acpi">thinkpad-acpi</a> with the &quot;fan_control=1&quot; parameter, and run:<br /><code># ./tp-fancontrol</code></p><p>There is an distro independent daemon (<a href="http://launchpad.net/tp-fan/tpfand/0.94/+download/tpfand-0.94.tar.gz" rel="nofollow">http://launchpad.net/tp-fan/tpfand/0.94/+download/tpfand-0.94.tar.gz</a>), written in python. Packages are available for debian based linux systems.</p><p><a href="http://www.gambitchess.org/moin.py/ThinkPad_Fan_Control" rel="nofollow">A GTK GUI program (packaged for Ubuntu 7.10 and 8.04)</a> may also help.</p> Automated program - Simple ThinkPad Fan Control<p>Written by Stanko, stanko [at] mfhinc [dot] net</p><p>This is program for controlling fans speed on IBM/Lenovo ThinkPads. It is writtenfor Linux only. This program is written in C, using GTK GUI.</p><p>You are required to have the Linux kernel with 'thinkpad-acpi' patch.You must also enable manual control for your fans. For Linux 2.6.22 and above,you must add 'fan_control=1' as a module parameter to 'thinkpad-acpi'.For example, in Debian Lenny (and Ubuntu 8.04), you must add the followingto &quot;/etc/modprobe.d/options&quot;:</p>       options thinkpad_acpi fan_control=1<p>Having done so, reboot. Now you'll be able to use this program easily.</p><p>Here is screenshot:</p><a href="http://www.thinkwiki.org/wiki/File:Tpfc.png"><img alt="Tpfc.png" src="http://hiphotos.baidu.com/pengjunlong/pic/item/0df5cb09ab8f43ded0581b3f.jpg" height="400" width="499" /></a><p>and direct download (src + i386 32bit binary). Please read README.txt fileincluded in package. [<a href="http://stanko.mfhinc.net/projects/tpfc/tpfc0.5.tar.gz" rel="nofollow">tpfc0.5.tar.gz</a>]</p><p>I wrote this for my own personal use, and thought that it would be a good ideato release it to the world, and hope that it will be useful to someone!Feel free to send comments, bug reports or a thanks to the e-mail above.</p> For Windows<p>Shimodax's ThinkPad fan control tool offers similar functionality (see <a href="http://forum.thinkpads.com/viewtopic.php?t=17715" rel="nofollow">forum discussion</a> at thinkpads.com).  Source and binaries are available through the <a href="http://sourceforge.net/projects/tp4xfancontrol" rel="nofollow">&quot;Tp4xFanControl&quot;</a> project on SourceForge.</p> Hardware specs<p>The following <a href="http://www.thinkwiki.org/wiki/How_to_control_fan_speed#">hardware</a> behavior was discovered experimentally by <a href="http://www.thinkwiki.org/wiki/User:Thinker" title="User:Thinker">Thinker</a> and neither provided by nor confirmed by IBM/Lenovo. The following description may be inaccurate and may vary by model (see list of models above). The terminology probably does not match the one used by IBM/Lenovo engineers.</p><b>NOTE!</b>Information on other models is included in the <a href="http://www.thinkwiki.org/wiki/Thinkpad-acpi" title="Thinkpad-acpi">thinkpad-acpi</a> <a href="http://www.thinkwiki.org/wiki/Git" title="Git">Git</a> version.<b>NOTE!</b>The ThinkPad <a href="http://www.thinkwiki.org/wiki/Category:X61s" title="Category:X61s">X61s</a> and <a href="http://www.thinkwiki.org/wiki/Category:X61" title="Category:X61">X61</a> with WWAN have a <a href="http://forum.notebookreview.com/showthread.php?t=141931" rel="nofollow">second system fan</a>.  It shares the same control register as the main fan (cannot be controlled separately), and exposes a second tachometer.<p>ACPI DSDT register HFSP (8 bits, offset 0x2F in the <tt>EmbeddedController</tt> address space, accessed through the standard EC interface at IO ports 0x62 and 0x66) is read/writable and has the following meaning:</p>Bits   7 6 5 4 3 2 1 0       ---------------Value  1 0 * * * * * *  - automatic       * 1 * * * * * *  - disengaged       0 0 N N N N N N  - manual (0..63; 0=disable fan, 1=min, ..., 7=max)<p>Changing modes may not be immediate on all ThinkPads.  Later ThinkPad models seem to take at least 5s to start responding to a fan mode change, for example.</p><p>After boot, the HFSP register may not reflect the true state of the EC (on some models it reads 0x07 even though the EC is actually in automatic mode).</p><p>The HFSP register controls both fans at the same time in the X61/X61s.</p>  Fan Tachometer <p>The embedded controller registers 0x84 (LSB), 0x85 (MSB) are the main fan tachometer, and report fan speed in RPM in everything since the <a href="http://www.thinkwiki.org/wiki/Category:A31" title="Category:A31">A31</a> and maybe a little earlier.  Not much is know about the tachometer in earlier models, or even whether they had one or not.</p><p>On the X61/X61s, one must select through EC register 0x31 bit 0 which fan the tachometer registers will expose (Firmware 7M).  Beware: this is the same register used for brightness control in other models.</p>  Automatic mode <p>In <i>automatic</i> mode, the embedded controller sets the fan speed automatically according to system temperatures and some unknown algorithm.</p><p>Note that the ACPI DSDT may supplement this in some models.  The <a href="http://www.thinkwiki.org/wiki/Category:X40" title="Category:X40">X40</a>, for example, changes the profile of speeds the automatic mode should use depending on battery status.</p>  Manual mode <p>In <i>manual</i> mode, the fan level is forced to the given value and the EC will auto-regulate the fan to maintain at a (roughly) constant RPM, which is model-dependent. Manual speed levels 8-63 yield the same behavior as level 7, and the the ACPI DSDT uses level 7 for the emergency mode it enters upon critical CPU/GPU temperature, so apparently 7 is the real maximum level.</p>  Disengaged (full-speed) mode <p>In <i>disengaged</i> mode, the embedded controller does not monitor the fan speed.  It &quot;disengages&quot; the closed-loop control function that keeps track of fan speed, and uses an open-loop control function that ramps up the fan to its maximum speed (100% duty-cycle).  The end speed is not stable, but it is often much faster than the maximum speed manual and automatic modes would set the fan to.</p><p>Most newer ThinkPads take quite a while (in excess of one minute) to fully enter disengaged mode.  Exiting it is much faster.  The <a href="http://www.thinkwiki.org/wiki/Category:A31" title="Category:A31">A31</a> acts differently, and switches to disengaged mode as fast as it switches to other modes.</p><p>For some reason, the embedded controller may stop updating the tachometer registers while entering or exiting disengaged mode in some ThinkPad firmware versions (hence the EC tachometer registers will not be updated on these models while entering/exiting disengaged mode).  Once it arrives at maximum speed, or once it gets back at closed-loop cruise speed, the embedded controller starts updating the tachometer registers again.   Later T models such as the <a href="http://www.thinkwiki.org/wiki/Category:T43" title="Category:T43">T43</a> have this problem, while the <a href="http://www.thinkwiki.org/wiki/Category:A31" title="Category:A31">A31</a> does not.</p>Hint:<p>Apparently the <a href="http://www.thinkwiki.org/wiki/Problem_with_fan_noise" title="Problem with fan noise">pulsing fan noise</a> experienced by some users can be cured by repeatedly running 2-4 seconds of manual control followed by 0.5-1 seconds of disengaged mode. The pulse occurs when the the embedded controller computes the fan speed and adjusts the fan voltage adaptively every few seconds (~4.8sec for the ThinkPad T43); the aforementioned mode switching doesn't give it a chance to do so. One of the <a href="http://www.thinkwiki.org/wiki/ACPI_fan_control_script#Variable_speed_control_scripts" title="ACPI fan control script">ACPI fan control scripts</a> implements this solution. </p><p></p>thinkfan: A simple fan control program<p>Originally designed specifically for IBM/Lenovo Thinkpads, it now supports anykind of system via the sysfs hwmon interface (/sys/class/hwmon). It isdesigned to eat as little CPU power as possible.The development was inspired by the excellent work people have done on<a href="http://www.thinkwiki.org/wiki/How_to_control_fan_speed">thinkwiki.org</a>.</p><p>thinkfan does <b>NOT</b> work on Windows. It's a Linux only program.</p><p>Debian has it in the repositories, so if you're using Debian or Ubuntu, youshould install it from your regular package manager.</p>News:<p>Version 0.7 has just been released, which includes an important new feature:</p>Correction Values<p>Temperatures that are perfectly fine for your CPU may already be dangerous formost hard disks.</p><p>For simplicity's sake, thinkfan uses only the highest temperature found in thesystem, but that'll most likely never be your harddisk. Thus you can nowspecify a correction value for any sensor. This value is added to the actualtemperature and can be used to give that sensor a greater chance of beingconsidered in the fan speed decision.I know this is quite unintuitive, but it's the least intrusive way of handlingthis (for now). In a later release, I might extend the config syntax to allowfor sensor-specific temperature limits.</p><p>So please do check out the updated README and example configs, and modify yourconfig to save your harddisk from premature death. :-/</p>Config Syntax<p>Thinkfan now has a shiny new (as in cheesy, but better than scanf) parser forthe config files. It was actually already used in 0.6.5. However in thisrelease it was changed to be much tighter on the config syntax. In allprevious releases, it just skipped anything it didn't reconize. You could thushave arbitrary garbage in your config file and thinkfan would just ignore it.These times are over. Thinkfan now rejects anything that isn't a properstatement or a comment. You can get the old behaviour back by using the -D(DANGEROUS) option.</p><p>If you want to install it manually, go ahead and<a href="http://sourceforge.net/projects/thinkfan/files/">download the source code</a>.</p><p> <a href="http://validator.w3.org/check?uri=http://thinkfan.sourceforge.net/">  <img src="http://hiphotos.baidu.com/pengjunlong/pic/item/2c738682cb0913e36d81193f.jpg" alt="Valid HTML 4.01 Transitional" height="31" width="88" /> </a></p> </div>