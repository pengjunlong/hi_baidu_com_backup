<h2></h2><br/><h1>TFTP编程之客户机篇cmdprocess.h</h1><hr/>
<div id=content class="content mod-cs-content text-content clearfix"> <p>/****************************************************************/<br />/****************************************************************/<br />int  stripcmd(char *s,char cmd[][256]); /*分开输入的命令语句的命令及参数*/<br />void parsecmd(char *s);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /*解析命令,回调相应函数*/<br />int  getcmdsubscript(char *s);&nbsp;&nbsp;&nbsp; /*获取命令数组的下标*/</p><p><br />/*************************************************************/<br />/*定义一个存储回调函数的命令代码数组，其值与不同的命令相对应*/<br />CMDNUM cmdlist[] = {<br /> {&quot;help&quot;&nbsp;&nbsp;  ,1,0,showhelp},<br /> {&quot;link&quot;,2,1,connectto},<br /> {&quot;exit&quot;&nbsp;&nbsp;  ,3,0,quit},<br /> {&quot;get&quot;&nbsp;&nbsp;&nbsp;  ,4,1,getfile},<br /> {&quot;put&quot;&nbsp;&nbsp;&nbsp;  ,5,2,putfile}&nbsp;&nbsp; };<br />/************************************************************/</p><p>/**************************************************************/<br />int stripcmd(char *s,char cmd[][256])<br />{<br /> int i=0;<br /> char *token=NULL;<br /> char seps[] = &quot; ,\t\n&quot;;&nbsp;&nbsp;<br /> token = strtok( s, seps );&nbsp;&nbsp; /*断开命令与参数*/<br /> while(token!=NULL){<br />&nbsp;&nbsp; if (i&gt;2) break; /*因为回调函数的参数最多为2个，当识别出的参数多于2个时，忽略多于的*/ <br />&nbsp;&nbsp; strcpy(cmd[i],token);<br />&nbsp;&nbsp; token = strtok( NULL, seps );/*注意到上面这个NULL，它表明的是从上次调用结果中strtok自有的缓冲区中继续取出余下的子串*/<br />&nbsp;&nbsp; i++;<br /> }<br /> return i; <br />}<br />/**************************************************************/</p><p>/**************************************************************/<br />void parsecmd(char *s)<br />{<br /> char cmd[3][256];<br /> int pcount = 0;<br /> int subscript = -1;<br /> pcount = stripcmd(s,cmd);&nbsp;&nbsp; /*分开命令与参数，返回值为参数的个数加1*/<br /> subscript=getcmdsubscript(cmd[0]); /*获取下标*/<br /> if(subscript==-1){<br />&nbsp;&nbsp; printf(&quot;No such commond \n&quot;);<br />&nbsp;&nbsp; return;<br /> }<br /> else{<br />&nbsp;&nbsp; cmdlist[subscript].callback(cmd,pcount-1);/*根据命令回调相应的函数*/<br /> }<br />}<br />/*************************************************************/</p><p>/**************************************************************/<br />int  getcmdsubscript(char *s)<br />{<br /> int i = 0;<br /> for(i=0;i&lt;sizeof(cmdlist)/sizeof(CMDNUM);i++){/*这里sizeof(cmdlist)/sizeof(CMDNUM)==5*/<br />&nbsp;&nbsp; if(stricmp(s,cmdlist[i].cmd)==0){<br />&nbsp;&nbsp;&nbsp; return i;<br />&nbsp;&nbsp; }<br /> }<br /> return -1;  <br />}<br />/**************************************************************/</p> </div>