---
layout: post
title: TFTP编程之服务器篇log.h
time: 2008-09-11 13:09
tags: 
---

<div id=content class="content mod-cs-content text-content clearfix"> <p>//日志<br />char log[100];<br />//记录时间变量<br />char datetime[20];<br />//服务器参数<br />#include &quot;time.h&quot;<br />#include &quot;stdlib.h&quot;<br />#include &quot;stdio.h&quot;<br />int  timeout=2,retran=3;</p><p>void record(int a,struct sockaddr_in *sin,char *file)<br />{<br /> char tem[60];<br /> time_t t=time(0);//其值是系统从1970年1月1日00:00:00到现在总共的秒数<br /> strftime(datetime,sizeof(datetime),&quot;%y/%m/%d %X&quot;,localtime(&amp;t));//localtime 功 能: 把从1970-1-1零点零分到当前时间系统所偏移的秒数时间转换为日历时间<br /> strcat(log,datetime);//给日志记录加上时间</p><p> ZeroMemory(&amp;tem,sizeof(tem));<br /> if(a==1)<br />&nbsp;&nbsp; sprintf(tem,&quot; 收到 %s 上传文件 %s 的请求!\n&quot;,inet_ntoa(sin-&gt;sin_addr),file);//sprintf 将字串格式化<br /> if(a==2)<br />&nbsp;&nbsp; sprintf(tem,&quot; %s 上传文件 %s 完毕!\n&quot;,inet_ntoa(sin-&gt;sin_addr),file);<br /> if(a==3)<br />&nbsp;&nbsp; sprintf(tem,&quot; 收到 %s 下载文件 %s的请求!\n&quot;,inet_ntoa(sin-&gt;sin_addr),file);<br /> if(a==4)<br />&nbsp;&nbsp; sprintf(tem,&quot; %s 下载文件 %s 完毕!\n&quot;,inet_ntoa(sin-&gt;sin_addr),file);<br /> if(a==5)<br />&nbsp;&nbsp; sprintf(tem,&quot; 找不到该文件!\n&quot;,inet_ntoa(sin-&gt;sin_addr),file);<br /> if(a==6)<br />&nbsp;&nbsp; sprintf(tem,&quot; 打开文件出错!\n&quot;,inet_ntoa(sin-&gt;sin_addr),file);<br /> if(a==7)<br />&nbsp;&nbsp; sprintf(tem,&quot; Socket error!\n&quot;,inet_ntoa(sin-&gt;sin_addr),file);<br /> if(a==8)<br />&nbsp;&nbsp; sprintf(tem,&quot; 等待超时!\n&quot;,inet_ntoa(sin-&gt;sin_addr),file);<br /> if(a==9)<br />&nbsp;&nbsp; sprintf(tem,&quot; 不能创建文件!\n&quot;,inet_ntoa(sin-&gt;sin_addr),file);<br /> if(a==0)<br />&nbsp;&nbsp; sprintf(tem,&quot; 出错!操作中断。\n&quot;,inet_ntoa(sin-&gt;sin_addr),file);<br /> strcat(log,tem);//给日志记录加上事件<br /> <br /> FILE *write;<br /> if((write=fopen(&quot;tftp.log&quot;,&quot;a+&quot;))==NULL)<br />&nbsp;&nbsp; printf(&quot;Open logfile failure!\n&quot;);<br /> fwrite(&amp;log,strlen(log),1,write);<br /> fclose(write);<br /> ZeroMemory(&amp;log,sizeof(log));//写日志<br />}</p> </div>