---
layout: post
title: tc.sh
time: 2011-02-23 11:04
tags: 好好学习天天向上
---

<div id=content class="content mod-cs-content text-content clearfix"> <p>#!/bin/bash<br />ifs=eth0<br />DPnum=2<br />LIMIT=600KB<br />MIN=15KB<br />MAX=60KB<br />BURST=20<br />AVPKT=1000<br />BW=100Mbit<br />P0=0.01<br />P1=0.03<br /><br />########################################################<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 1 --- Main dsmark<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tc qdisc del dev $ifs&nbsp;root<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tc qdisc add dev $ifs&nbsp;handle 1:0&nbsp;root dsmark indices 64&nbsp;set_tc_index<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 2 --- Main dsmark classifier<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tc filter add dev $ifs&nbsp;parent 1:0&nbsp;protocol ip prio 1&nbsp;tcindex mask 0xfc shift&nbsp;2&nbsp;pass_on<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# --- Main dsmark classifier's elements<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 3 --- AF Class 1 for audio<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tc filter add dev $ifs&nbsp;parent 1:0&nbsp;protocol ip prio 1&nbsp;handle 26&nbsp;tcindex classid 1:110<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tc filter add dev $ifs&nbsp;parent 1:0&nbsp;protocol ip prio 1&nbsp;handle 30&nbsp;tcindex classid 1:111<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tc filter add dev $ifs&nbsp;parent 1:0&nbsp;protocol ip prio 1&nbsp;handle 14&nbsp;tcindex classid 1:112<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 8 --- Main htb qdisc<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tc qdisc add dev $ifs&nbsp;parent 1:0&nbsp;handle 2:0&nbsp;htb<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 9 --- Main htb class<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tc class add dev $ifs&nbsp;parent 2:0&nbsp;classid 2:1&nbsp;htb rate $BW&nbsp;ceil $BW<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 10 --- Main htb classifier<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tc filter add dev $ifs&nbsp;parent 2:0&nbsp;protocol ip prio 1&nbsp;tcindex mask 0xf0 shift&nbsp;4&nbsp;pass_on<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# --- Main htb classifier's elements<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 11 --- AF Class 1<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tc filter add dev $ifs&nbsp;parent 2:0&nbsp;protocol ip prio 1&nbsp;handle 1&nbsp;tcindex classid 2:10<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 16 --- AF Class 1 specific setup---<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tc class add dev $ifs&nbsp;parent 2:1&nbsp;classid 2:10&nbsp;htb rate $BW&nbsp;ceil $BW<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tc qdisc add dev $ifs&nbsp;parent 2:10&nbsp;gred setup DPs 3&nbsp;default 2&nbsp;grio<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 17 --- AF Class 1 DP 0---<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tc qdisc change dev $ifs&nbsp;parent 2:10&nbsp;gred limit $LIMIT&nbsp;min $MIN&nbsp;max $MAX&nbsp;burst $BURST&nbsp;avpkt $AVPKT&nbsp;bandwidth $BW&nbsp;DP 0&nbsp;probability $P0&nbsp;prio 2<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 18 --- AF Class 1 DP 1---<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tc qdisc change dev $ifs&nbsp;parent 2:10&nbsp;gred limit $LIMIT&nbsp;min $MIN&nbsp;max $MAX&nbsp;burst $BURST&nbsp;avpkt $AVPKT&nbsp;bandwidth $BW&nbsp;DP 1&nbsp;probability $P1&nbsp;prio 3<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 19 --- AF Class 1 DP 2---<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tc qdisc change dev $ifs&nbsp;parent 2:10&nbsp;gred limit $LIMIT&nbsp;min $MIN&nbsp;max $MAX&nbsp;burst $BURST&nbsp;avpkt $AVPKT&nbsp;bandwidth $BW&nbsp;DP 2&nbsp;probability $P1&nbsp;prio 4<br /></p> </div>