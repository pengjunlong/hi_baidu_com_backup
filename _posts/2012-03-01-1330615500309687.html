---
layout: post
title: req.c
time: 2012-03-01 23:25
keywords: 好好学习天天向上
---
<div id=content class="content mod-cs-content text-content clearfix"> openflow@nox1:~/OMNI/nox/build/src$ cat req.c<br />#include &lt;stdio.h&gt;<br />#include &lt;stdlib.h&gt;<br />//string.h包含bzero()<br />#include &lt;string.h&gt;<br />//unistd.h包含read(), write(), close()<br />#include &lt;unistd.h&gt;<br />#include &lt;sys/socket.h&gt;<br />//ctype.h包含toupper<br />#include &lt;ctype.h&gt;<br />#include &lt;netinet/in.h&gt;<br />#include &lt;arpa/inet.h&gt;<br /><br />#define MAXSIZE 65535<br />#define SERVER_PORT 8006<br />#define LINE 1024<br /><br />int main(int argc, char *argv[]) {<br />&nbsp;&nbsp; &nbsp;struct sockaddr_in server_addr;<br />&nbsp;&nbsp; &nbsp;char buf[MAXSIZE];<br />&nbsp;&nbsp; &nbsp;int sockfd;<br />&nbsp;&nbsp; &nbsp;int n;<br />&nbsp;&nbsp; &nbsp;char *str = (char*)malloc(MAXSIZE);<br />&nbsp;&nbsp; &nbsp;FILE *fp;<br /><br />&nbsp;&nbsp; &nbsp;if (argc != 3) {<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;printf(&quot;usage: ./req FV_ip fileName\n&quot;);<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;exit(1);<br />&nbsp;&nbsp; &nbsp;}<br /><br />&nbsp;&nbsp; &nbsp;if ((fp=fopen(argv[2],&quot;r&quot;))==NULL)<br />&nbsp;&nbsp; &nbsp;{<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;printf(&quot;Cannot open file!\n&quot;);<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;exit(0);<br />&nbsp;&nbsp; &nbsp;}<br />&nbsp;&nbsp; &nbsp;char *line = (char *)malloc(LINE*sizeof(char));<br />&nbsp;&nbsp; &nbsp;strcpy(str, &quot;&quot;);<br />&nbsp;&nbsp; &nbsp;while(fgets(line, LINE, fp))<br />&nbsp;&nbsp; &nbsp;{<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;strcat(str, line);<br />&nbsp;&nbsp; &nbsp;}<br /><br />&nbsp;&nbsp; &nbsp;sockfd = socket(AF_INET, SOCK_STREAM, 0);<br />&nbsp;&nbsp; &nbsp;bzero(&amp;server_addr, sizeof(server_addr));<br />&nbsp;&nbsp; &nbsp;server_addr.sin_family = AF_INET;<br />&nbsp;&nbsp; &nbsp;inet_pton(AF_INET, argv[1], &amp;server_addr.sin_addr);<br />&nbsp;&nbsp; &nbsp;server_addr.sin_port = htons(SERVER_PORT);<br /><br />&nbsp;&nbsp; &nbsp;connect(sockfd, (struct sockaddr *)&amp;server_addr, sizeof(server_addr));<br /><br />&nbsp;&nbsp; &nbsp;write(sockfd, str, strlen(str));<br /><br />&nbsp;&nbsp; &nbsp;n = read(sockfd, buf, MAXSIZE);<br />&nbsp;&nbsp; &nbsp;//printf(&quot;Response from server:\n&quot;);<br />&nbsp;&nbsp; &nbsp;//write(STDOUT_FILENO, buf, n);<br />&nbsp;&nbsp; &nbsp;//printf(&quot;\n&quot;);<br />&nbsp;&nbsp; &nbsp;close(sockfd);<br />&nbsp;&nbsp; &nbsp;if(strcmp(buf, &quot;ok&quot;)==0)<br />&nbsp;&nbsp; &nbsp;{<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;int ret = system(&quot;sudo ./nox_core -v -v -i ptcp:3366 mywebserver&quot;);<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;printf(&quot;\nnox exit, return %d\n&quot;, ret);<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;strcpy(str, &quot;$&quot;);<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;strcat(str, &quot;\n&quot;);<br /><br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sockfd = socket(AF_INET, SOCK_STREAM, 0);<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;bzero(&amp;server_addr, sizeof(server_addr));<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;server_addr.sin_family = AF_INET;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;inet_pton(AF_INET, argv[1], &amp;server_addr.sin_addr);<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;server_addr.sin_port = htons(SERVER_PORT);<br /><br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;connect(sockfd, (struct sockaddr *)&amp;server_addr, sizeof(server_addr));<br /><br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;write(sockfd, str, strlen(str));<br /><br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;n = read(sockfd, buf, MAXSIZE);<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;close(sockfd);<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;return 0;<br />&nbsp;&nbsp; &nbsp;}<br />&nbsp;&nbsp; &nbsp;else<br />&nbsp;&nbsp; &nbsp;{<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;write(STDOUT_FILENO, buf, n);<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;printf(&quot;\n&quot;);<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;return 0;<br />&nbsp;&nbsp; &nbsp;}<br />}<br />openflow@nox1:~/OMNI/nox/build/src$ <br /><br /> </div>