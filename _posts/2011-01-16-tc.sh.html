tag=好好学习天天向上
<div id=content class="content mod-cs-content text-content clearfix"> <p>#!/bin/bash<br />ifs=eth0<br />DPnum=2<br />LIMIT=600KB<br />MIN=15KB<br />MAX=60KB<br />BURST=20<br />AVPKT=1000<br />BW=100Mbit<br />P0=0.01<br />P1=0.03<br /><br />########################################################<br />&nbsp;&nbsp;&nbsp; # 1 --- Main dsmark<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tc qdisc del dev $ifs root<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tc qdisc add dev $ifs handle 1:0 root dsmark indices 64 set_tc_index<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # 2 --- Main dsmark classifier<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tc filter add dev $ifs parent 1:0 protocol ip prio 1 tcindex mask 0xfc shift 2 pass_on<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # --- Main dsmark classifier's elements<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # 3 --- AF Class 1 for audio<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tc filter add dev $ifs parent 1:0 protocol ip prio 1 handle 26 tcindex classid 1:110<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tc filter add dev $ifs parent 1:0 protocol ip prio 1 handle 30 tcindex classid 1:111<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tc filter add dev $ifs parent 1:0 protocol ip prio 1 handle 14 tcindex classid 1:112<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # 8 --- Main htb qdisc<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tc qdisc add dev $ifs parent 1:0 handle 2:0 htb<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # 9 --- Main htb class<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tc class add dev $ifs parent 2:0 classid 2:1 htb rate $BW ceil $BW<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # 10 --- Main htb classifier<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tc filter add dev $ifs parent 2:0 protocol ip prio 1 tcindex mask 0xf0 shift 4 pass_on<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # --- Main htb classifier's elements<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # 11 --- AF Class 1<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tc filter add dev $ifs parent 2:0 protocol ip prio 1 handle 1 tcindex classid 2:10<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # 16 --- AF Class 1 specific setup---<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tc class add dev $ifs parent 2:1 classid 2:10 htb rate $BW ceil $BW<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tc qdisc add dev $ifs parent 2:10 gred setup DPs 3 default 2 grio<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # 17 --- AF Class 1 DP 0---<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tc qdisc change dev $ifs parent 2:10 gred limit $LIMIT min $MIN max $MAX burst $BURST avpkt $AVPKT bandwidth $BW DP 0 probability $P0 prio 2<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # 18 --- AF Class 1 DP 1---<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tc qdisc change dev $ifs parent 2:10 gred limit $LIMIT min $MIN max $MAX burst $BURST avpkt $AVPKT bandwidth $BW DP 1 probability $P1 prio 3<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # 19 --- AF Class 1 DP 2---<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tc qdisc change dev $ifs parent 2:10 gred limit $LIMIT min $MIN max $MAX burst $BURST avpkt $AVPKT bandwidth $BW DP 2 probability $P1 prio 4</p> </div>