<h2></h2><br/><h1>TFTP编程之客户机篇client.cpp</h1><hr/>
<div id=content class="content mod-cs-content text-content clearfix"> <p>/**************************************************************/<br />/*TFTP_client*/<br />/**************************************************************/</p><p>#define _VC /* if compile under visiual c++ else undefine this*/</p><p>#include &lt;stdio.h&gt;<br />#include &lt;winsock.h&gt;<br />#include &lt;conio.h&gt;</p><p>#ifdef _VC<br />#pragma comment( lib, &quot;Wsock32.lib&quot; )<br />#endif</p><p>#include &quot;cmdfunction.h&quot;<br />#include &quot;define.h&quot;<br />#include &quot;cmdprocess.h&quot;</p><p> </p><p>SOCKET sock = INVALID_SOCKET;&nbsp;&nbsp; /*#define INVALID_SOCKET  (SOCKET)(~0)*/<br />char desthost[256] = &quot;127.0.0.1&quot;; /*目的主机地址，默认为本机*/<br />int  filemode = TFTP_OCTET;&nbsp;&nbsp;&nbsp; /*发送模式设置为octet*/</p><p><br />int main(int argc, char* argv[])<br />{<br /> printf(&quot;\t\tTFTP_client v1.1\n&quot;); /*显示帮助信息*/<br /> printf(&quot;************************************************************\n\n&quot;);<br /> printf(helptext);<br /> char cmd[256];<br />&nbsp;&nbsp;&nbsp;  int ret = 0; <br /> sockaddr_in addr;</p><p> WSADATA stWSAData;<br /> if(WSAStartup(WSA_VERSION, &amp;stWSAData)!=0){ /*启用winsock*/<br />&nbsp;&nbsp; printf(&quot;Can't start Socket \n&quot;);<br />&nbsp;&nbsp; exit(0);<br /> }<br />&nbsp;&nbsp;&nbsp;  <br />&nbsp;&nbsp;&nbsp;  sock = socket(AF_INET,SOCK_DGRAM,0); /*#define AF_INET 2 (internetwork: UDP)*/<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /*#define SOCK_DGRAM 2(datagram socket)*/<br /> if(sock==INVALID_SOCKET){<br />&nbsp;&nbsp; printf(&quot;Can't create socket \n&quot;);<br />&nbsp;&nbsp; exit(0);<br /> }</p><p> /*初始化地址信息<br /> struct sockaddr_in {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  short&nbsp;&nbsp;  sin_family;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  u_short sin_port;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  struct  in_addr sin_addr;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  char&nbsp;&nbsp;&nbsp;  sin_zero[8];<br /> };*/<br /> addr.sin_family = AF_INET;<br /> addr.sin_port = htons(INADDR_ANY);<br /> addr.sin_addr.s_addr  = INADDR_ANY;<br /> <br /> if(bind(sock,(struct sockaddr *)&amp;addr,sizeof(addr))!=0){<br />&nbsp;&nbsp; printf(&quot;Can't bind socket \n&quot;);<br />&nbsp;&nbsp; exit(0);<br /> }<br /> while(true){<br />&nbsp;&nbsp; fflush( stdin ); /*清空缓冲区*/<br />&nbsp;&nbsp; printf(&quot;请输入命令：&quot;);<br />&nbsp;&nbsp; gets(cmd);&nbsp;&nbsp;&nbsp; /*接收键盘输入*/<br />&nbsp;&nbsp; parsecmd(cmd);&nbsp;&nbsp; /*解析输入的命令*/<br /> }<br /> return 0;<br />}</p> </div>