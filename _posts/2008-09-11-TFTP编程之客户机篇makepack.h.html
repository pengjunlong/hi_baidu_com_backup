<h2></h2><br/><h1>TFTP编程之客户机篇makepack.h</h1><hr/>
<div id=content class="content mod-cs-content text-content clearfix"> <p>/*************************************************************/</p><p>#include &quot;define.h&quot;</p><p><br />int  makeack(unsigned short num,char *buffer,int size );<br />int  makereq(char type,int mode,char *filename,char *buffer,int size);<br />int  makedata(unsigned short num,char *data,int datasize,char *buffer,int bufsize);<br />/*************************************************************/</p><p>int makeack(unsigned short num,char *buffer,int size )<br />{<br /> int pos = 0;<br /> buffer[pos] = 0;<br /> pos++;<br /> buffer[pos] = TFTP_ACK;<br /> pos++;<br /> buffer[pos] = (char)(num &gt;&gt; 8);<br /> pos++;<br /> buffer[pos] = (char)num;<br /> pos++;<br /> return pos;<br />}</p><p>int makereq(char type,int mode,char *filename,char *buffer,int size)<br />{<br /> int pos = 0;<br /> unsigned int i = 0;<br /> char *s = &quot;octet&quot;;</p><p> buffer[pos] = 0;<br /> pos++;<br /> buffer[pos] = type;<br /> pos++;</p><p> for(i=0;i&lt;strlen(filename);i++){<br />&nbsp;&nbsp; buffer[pos] = filename[i];<br />&nbsp;&nbsp; pos++;<br /> }<br /> buffer[pos] = 0;<br /> pos++;<br /> for(i=0;i&lt;strlen(s);i++){<br />&nbsp;&nbsp; buffer[pos] = s[i];<br />&nbsp;&nbsp; pos++;<br /> }<br /> buffer[pos] = 0;<br /> pos++;<br /> return pos;<br />}</p><p>int makedata(unsigned short num,char *data,int datasize,char *buffer,int bufsize)<br />{<br /> int pos = 0;<br /> buffer[pos] = 0;<br /> pos++;<br /> buffer[pos] = TFTP_DATA;<br /> pos++;<br /> buffer[pos] = (char)(num&gt;&gt;8);<br /> pos++;<br /> buffer[pos] = (char)num;<br /> pos++;<br /> memcpy(&amp;buffer[pos],data,datasize);<br /> pos = pos + datasize;<br /> return pos;<br />}</p> </div>