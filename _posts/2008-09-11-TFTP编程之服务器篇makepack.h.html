<h2></h2><br/><h1>TFTP编程之服务器篇makepack.h</h1><hr/>
<div id=content class="content mod-cs-content text-content clearfix"> <p>/*************************************************************/</p><p>#include &quot;define.h&quot;</p><p><br />int  makeack(unsigned short num,char *buffer,int size );<br />int  makedata(unsigned short num,char *data,int datasize,char *buffer,int bufsize);<br />int  makeerr(unsigned short num,char *buffer);<br />/*************************************************************/</p><p>int makeack(unsigned short num,char *buffer,int size )//应答报文(ACK)<br />{<br /> int pos = 0;<br /> buffer[pos] = 0;<br /> pos++;<br /> buffer[pos] = TFTP_ACK;&nbsp;&nbsp;&nbsp; //opcode=04<br /> pos++;<br /> buffer[pos] = (char)(num&gt;&gt;8);<br /> pos++;<br /> buffer[pos] = (char)num;&nbsp;&nbsp; //blocknum<br /> pos++;<br /> return pos;<br />}</p><p>int makedata(unsigned short num,char *data,int datasize,char *buffer,int bufsize) //数据报文(DATA)<br />{<br /> int pos = 0;<br /> buffer[pos] = 0;<br /> pos++;<br /> buffer[pos] = TFTP_DATA;&nbsp;&nbsp; //opcode=03<br /> pos++;<br /> buffer[pos] = (char)(num&gt;&gt;8);<br /> pos++;<br /> buffer[pos] = (char)num;&nbsp;&nbsp; //blocknum<br /> pos++;<br /> memcpy(&amp;buffer[pos],data,datasize); //由data所指内存区域复制datasize个字节到&amp;buffer[pos]所指内存区域<br /> pos = pos + datasize;<br /> return pos;<br />}</p><p>int makeerr(unsigned short num,char *buffer) //错误报告ERROR<br />{<br /> int pos=0;<br /> buffer[pos]=0;<br /> pos++;<br /> buffer[pos]=TFTP_ERROR;&nbsp;&nbsp;&nbsp; //opcode=05<br /> pos++;<br /> buffer[pos] = (char)(num&gt;&gt;8);<br /> pos++;<br /> buffer[pos] = (char)num;&nbsp;&nbsp; //blocknum<br /> pos++;<br /> return pos;<br />}</p> </div>